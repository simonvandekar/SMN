<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Statistical Methods for Neuroimaging - Homework: Despicable Me First-level Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Statistical Methods for Neuroimaging</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-lecture-notes" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Lecture Notes</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-lecture-notes">    
        <li>
    <a class="dropdown-item" href="../../../1introduction_data_modalities/introduction_data_modalities.html" rel="" target="_blank">
 <span class="dropdown-text">Introduction &amp; Data Modalities</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../2preprocessing/preprocessing.html" rel="" target="_blank">
 <span class="dropdown-text">Preprocessing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../3first-level_analysis/first-level_analysis.html" rel="" target="_blank">
 <span class="dropdown-text">First-level Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../3group-level_analysis/group-level_analysis.html" rel="" target="_blank">
 <span class="dropdown-text">Group-level Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../4modern_topics/modern_topics.html" rel="" target="_blank">
 <span class="dropdown-text">Modern Topics</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#batch-brain-extraction-20-pts" id="toc-batch-brain-extraction-20-pts" class="nav-link" data-scroll-target="#batch-brain-extraction-20-pts">Batch brain extraction (20 pts)</a></li>
  <li><a href="#fmri-first-level-analysis-30-pts" id="toc-fmri-first-level-analysis-30-pts" class="nav-link" data-scroll-target="#fmri-first-level-analysis-30-pts">fMRI first-level analysis (30 pts)</a></li>
  <li><a href="#deliverables-10-pts" id="toc-deliverables-10-pts" class="nav-link" data-scroll-target="#deliverables-10-pts">Deliverables (10 pts)</a>
  <ul class="collapse">
  <li><a href="#registration-qa" id="toc-registration-qa" class="nav-link" data-scroll-target="#registration-qa">Registration QA</a></li>
  <li><a href="#motion-qa" id="toc-motion-qa" class="nav-link" data-scroll-target="#motion-qa">Motion QA</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Homework: <em>Despicable Me</em> First-level Analysis</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p><strong>Goal:</strong> <em>Effectively</em> implement fMRI batch first-level analysis for the <em>Despicable Me</em> data for the subset of participants assigned to you. “Effectively” means quality checking intermediate steps.</p>
<p><strong>Instructions:</strong> There are 100 participant folders in the <code>data/RBC/HBN_BIDS/</code> <a href="https://vanderbilt.box.com/s/7tb7738agklrsp3sw7d1w7c36g0bn091">folder</a>. One is assigned to you in this <a href="https://docs.google.com/document/d/1hYff8xvkZmRjfio6mS5hIENpfoW19KzafYFAcMh5DV4/edit?usp=sharing">Google doc</a> where we will put the quality assurance (QA) summaries.</p>
<p><strong>Deliverables:</strong> This document edited to include</p>
<ul>
<li>Commented code describing each step.</li>
<li>Visualizations and commentary, as requested specifically, below.</li>
<li>All the output from your preprocessing steps included in the participant’s folder on the Box drive.</li>
<li>QA summaries generated by FSL in the <a href="https://docs.google.com/document/d/1hYff8xvkZmRjfio6mS5hIENpfoW19KzafYFAcMh5DV4/edit?usp=sharing">Google doc</a>.</li>
</ul>
<p><strong>Hint:</strong> This file is located at <code>3first-level_analysis/homework/``first-level_analysis``/``first-level_analysis.``qmd</code>.</p>
</section>
<section id="batch-brain-extraction-20-pts" class="level2">
<h2 class="anchored" data-anchor-id="batch-brain-extraction-20-pts">Batch brain extraction (20 pts)</h2>
<p>After our last class, we should have found one of two brain extraction methods that worked well for these data and decided as a class (if not, yet, remind Simon about that we need to do this). Run brain extraction on your full subset of images to get the output you need as input for FEAT. You can work in your group or as a class to write a batch script, or you can share code to do this.</p>
<p>Write a loop in <code>R</code> in this document to create a visualization of one or a couple slices for each participant to quality check the brain extraction and add it to this document to be submitted as an html.</p>
</section>
<section id="fmri-first-level-analysis-30-pts" class="level2">
<h2 class="anchored" data-anchor-id="fmri-first-level-analysis-30-pts">fMRI first-level analysis (30 pts)</h2>
<p>Start the FSL GUI from the command line by typing <code>fsl</code> and then open the FEAT fMRI Analysis (can also do this directly typing <code>Feat_gui</code> at the command line. Open the <code>.fsf</code> file you produced from your last homework and set it up to perform the statistical analysis for the <em>Despicable Me</em> data. All the prior settings you used before loaded in.</p>
<p><strong>Hint:</strong> On my laptop, when I change the tab in the FEAT GUI, all the buttons disappear; if you adjust the window size, they reappear.</p>
<p><strong>Do these things</strong>:</p>
<ul>
<li>Set the temporal filtering high-pass filtering to 130 seconds.</li>
<li>Make sure you have the right slice timing file. This should be the same for all participants you are analyzing.</li>
<li>Select all 4D Nifti images for the subset of participants you are analyzing.</li>
<li>Select all brain-extracted structural images for the subset of participants you are analyzing. <strong>Hint:</strong> They have to be in the same order as the 4D fMRI images.</li>
<li>Construct two events, include the temporal derivative and apply temporal filtering to the event file. Use the double gamma HRF.
<ol type="1">
<li>Positive valence emotions</li>
<li>Negative valence emotions</li>
</ol></li>
<li>Construct three contrasts
<ol type="1">
<li>Positive valence emotions (versus baseline/unmodeled)</li>
<li>Negative valence emotions (versus baseline/unmodeled)</li>
<li>Positive minus negative emotions</li>
</ol></li>
</ul>
<p><strong>Include a screenshot of your design in here, in your html submission.</strong></p>
<p>Run the analysis. <strong>Hint:</strong> You might want to run it for one person and check the output. Then run it for everyone in your subset and run it overnight.</p>
</section>
<section id="deliverables-10-pts" class="level2">
<h2 class="anchored" data-anchor-id="deliverables-10-pts">Deliverables (10 pts)</h2>
<section id="registration-qa" class="level3">
<h3 class="anchored" data-anchor-id="registration-qa">Registration QA</h3>
<ul>
<li>Write a loop or <code>lapply</code> command to print all the functional-to-standard registration images (“Registration of example_func to standard”) into this document. Include the subject ID in the output so you can identify who they belong to. <strong>Hint:</strong> They are stored in the participants <code>.feat</code> folder output in the <code>mc</code> folder and you can print from loops using <code>results-'asis'</code> and <code>cat</code> to print the markdown syntax you need.</li>
<li>Create a list of participants whose registration is bad that we might exclude from analysis.</li>
</ul>
</section>
<section id="motion-qa" class="level3">
<h3 class="anchored" data-anchor-id="motion-qa">Motion QA</h3>
<ul>
<li>Write a loop or <code>lapply</code> command to print all the motion plots (“MCFLIRT estimated mean displacement (mm)”) into this document. Include the subject ID in the output so you can identify who they belong to. <strong>Hint:</strong> They are stored in the participants <code>.feat</code> folder output in the <code>mc</code> folder and you can print from loops using <code>results-'asis'</code> and <code>cat</code> to print the markdown syntax you need.</li>
<li>Create a list of participants whose mean relative displacement is larger than 0.5mm. We will exclude those participants from the analyses.</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
      }
    }
});
</script>
</div> <!-- /content -->



</body></html>